// Polkit rule: Allow {{ pi_user }} to manage services via D-Bus
// Deployed by Ansible - do not edit manually
polkit.addRule(function(action, subject) {
    if (subject.user != "{{ pi_user }}") return;

    // Start/Stop/Restart specific units
    if (action.id == "org.freedesktop.systemd1.manage-units" &&
        (action.lookup("unit") == "shairport-sync.service" ||
         action.lookup("unit") == "spotifyd.service" ||
         action.lookup("unit") == "bluetooth.service" ||
         action.lookup("unit") == "hostapd.service" ||
         action.lookup("unit") == "dnsmasq.service")) {
        return polkit.Result.YES;
    }

    // EnableUnitFiles/DisableUnitFiles
    if (action.id == "org.freedesktop.systemd1.manage-unit-files") {
        return polkit.Result.YES;
    }

    // Reload daemon (called after enable/disable)
    if (action.id == "org.freedesktop.systemd1.reload-daemon") {
        return polkit.Result.YES;
    }

    // Reboot/shutdown via logind (used by systembridge)
    if (action.id == "org.freedesktop.login1.reboot" ||
        action.id == "org.freedesktop.login1.reboot-multiple-sessions" ||
        action.id == "org.freedesktop.login1.power-off" ||
        action.id == "org.freedesktop.login1.power-off-multiple-sessions") {
        return polkit.Result.YES;
    }
});
